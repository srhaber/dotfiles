#!/bin/bash -e

# This script generates an updated Brewfile and commits it to dotfiles.
# Rationale is for posterity of packages and casks installed via brew for
# ease of setting up new dev environments
#
# Usage: <dotfiles>/scripts/brewdump

# Get script directory and derive dotfiles root
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
DOTFILES_DIR="$(dirname "$SCRIPT_DIR")"

brewfile=$(mktemp /tmp/Brewfile.XXXXX)
trap "rm -f $brewfile" EXIT

# Use brew from PATH (supports both Intel /usr/local and Apple Silicon /opt/homebrew)
brew bundle dump --file="$brewfile" --force --describe
mv "$brewfile" "$DOTFILES_DIR/Brewfile"

pushd "$DOTFILES_DIR" > /dev/null
git add Brewfile
git commit -m "Update Brewfile from installed packages

ðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)"
git push origin master
popd > /dev/null

echo "âœ… Brewfile updated and pushed to repository"
